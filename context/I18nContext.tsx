
import React, { createContext, useState, useContext, ReactNode, useCallback } from 'react';

type Language = 'en' | 'zh';

interface I18nContextProps {
  language: Language;
  setLanguage: (lang: Language) => void;
  t: (key: string, params?: Record<string, string | number>) => string;
}

const I18nContext = createContext<I18nContextProps | undefined>(undefined);

const translations: Record<Language, Record<string, string>> = {
  en: {
    // Menu
    'menu.dashboard': 'Dashboard',
    'menu.wdrAnalyze': 'WDR Analysis',
    'menu.wdrComparison': 'WDR Comparison',
    'menu.reports': 'Reports',
    'menu.comparison': 'Comparison',
    'menu.visualizer': 'Plan Visualizer',
    'menu.plandiff': 'Plan Diff',
    'menu.thresholds': 'Thresholds',
    'menu.sqlaudit': 'SQL Audit',
    'menu.auditlog': 'Audit Log',
    'header.role': 'Administrator',

    // Dashboard
    'dash.lastReport': 'Last Report',
    'dash.healthy': 'Healthy',
    'dash.warning': 'Warning',
    'dash.critical': 'Critical',
    'dash.score': 'Health Score',
    'dash.activeIssues': 'Active Issues',
    'dash.allInstances': 'All Instances',
    'dash.instanceOverview': 'Instance Overview',
    'dash.cpu': 'CPU Usage',
    'dash.mem': 'Memory Usage',
    'dash.tps': 'TPS',
    'dash.qps': 'QPS',
    'dash.health': 'Health Distribution',
    'dash.trend': 'Performance Trend',
    'dash.hotIssues': 'Hot Issues',
    'dash.details': 'Details',
    'dash.recentReports': 'Recent Reports',
    'dash.view': 'View',

    // Reports
    'rep.search': 'Search Instance...',
    'rep.upload': 'Upload Report',
    'rep.id': 'Report ID',
    'rep.instance': 'Instance',
    'rep.generated': 'Generated Time',
    'rep.period': 'Period',
    'rep.status': 'Status',
    'rep.actions': 'Actions',
    'rep.loading': 'Loading reports...',
    'rep.showing': 'Showing {start}-{end} of {total}',
    'rep.prev': 'Prev',
    'rep.next': 'Next',
    'rep.uploadTitle': 'Upload WDR Report',
    'rep.instanceName': 'Instance Name',
    'rep.desc': 'Description',
    'rep.file': 'Report File',
    'rep.clickUpload': 'Click to upload or drag and drop',
    'rep.fileHint': 'Supports HTML or WDR formats',
    'rep.cancel': 'Cancel',
    'rep.submit': 'Submit',
    'rep.deleteTitle': 'Delete Report',
    'rep.deleteConfirm': 'Are you sure you want to delete report #{id}? This action cannot be undone.',
    'rep.delete': 'Delete',
    'rep.viewTitle': 'Report Detail',
    'rep.tab.summary': 'Summary',
    'rep.tab.sqlstats': 'SQL Stats',
    'rep.tab.objstats': 'Object Stats',
    'rep.summary.efficiency': 'Efficiency',
    'rep.summary.workload': 'Workload Profile',
    'rep.metric': 'Metric',
    'rep.perSec': 'Per Second',
    'rep.perTxn': 'Per Txn',
    'rep.sql.orderBy': 'Order By',
    'rep.sql.elapsed': 'Elapsed Time',
    'rep.sql.cpu': 'CPU Time',
    'rep.sql.calls': 'Calls',
    'rep.sql.text': 'SQL Text',
    'rep.sql.visualize': 'Visualize Plan',
    'rep.obj.seqScan': 'Seq Scan',
    'rep.obj.idxScan': 'Idx Scan',
    'rep.obj.liveTup': 'Live Tuples',
    'rep.obj.deadTup': 'Dead Tuples',
    
    // Comparison (General)
    'comp.tab.sql': 'Top SQL',
    'comp.tab.wait': 'Wait Events',
    'comp.tab.obj': 'Object Stats',
    'comp.tab.sys': 'System Metrics',
    'comp.fingerprint': 'Fingerprint',
    'comp.r1': 'Report 1',
    'comp.r2': 'Report 2',
    'comp.change': 'Change',
    'comp.col.cpu': 'CPU Time',
    'comp.col.io': 'IO Time',
    'comp.col.phyRd': 'Phy Read',
    'comp.col.logRd': 'Log Read',
    'comp.action': 'Action',
    'comp.plan': 'Plan',
    'comp.col.event': 'Event',
    'comp.col.class': 'Class',
    'comp.col.object': 'Object',
    'comp.col.schema': 'Schema',
    'comp.col.diff': 'Diff',
    'comp.col.heapRd': 'Heap Read',
    'comp.col.heapHit': 'Heap Hit',
    'comp.col.idxRd': 'Idx Read',
    'comp.col.idxHit': 'Idx Hit',
    'comp.col.tup': 'Tuples (I/U/D)',
    'comp.col.metric': 'Metric',
    'comp.summary.title': 'Comparison Summary',
    'comp.status.degraded': 'Degraded',
    'comp.status.improved': 'Improved',
    'comp.status.stable': 'Stable',
    'comp.summary.score': 'Score Change',
    'comp.summary.conclusion': 'Conclusion',
    'comp.summary.findings': 'Key Findings',
    'comp.overview.title': 'Overview',
    'comp.chart.dbTime': 'DB Time',
    'comp.chart.cpu': 'CPU',
    'comp.chart.io': 'IOPS',
    'comp.selected': 'Selected Reports',
    'comp.new': 'New Comparison',
    'comp.name': 'Comparison Name',
    'comp.desc': 'Description',
    'comp.save': 'Save',

    // WDR Comparison Specific
    'wdr.comp.title': 'WDR Comparison Analysis',
    'wdr.comp.reset': 'Reset All',
    'wdr.comp.baseline': 'Baseline',
    'wdr.comp.target': 'Target',
    'wdr.comp.uploadBase': 'Upload Baseline WDR',
    'wdr.comp.addTarget': 'Add Target',
    'wdr.comp.keyMetrics': 'Key Metrics',
    'wdr.comp.topWait': 'Top Wait Events',
    'wdr.comp.topSql': 'Top 20 SQL',
    'wdr.comp.eventName': 'Event Name',
    'wdr.comp.baseWaits': 'Base Waits',
    'wdr.comp.baseAvg': 'Base Avg',
    'wdr.comp.baseMax': 'Base Max',
    'wdr.comp.waits': 'Waits',
    'wdr.comp.avg': 'Avg',
    'wdr.comp.max': 'Max',
    'wdr.comp.sort.total': 'By Total Time',
    'wdr.comp.sort.avg': 'By Avg Time',
    'wdr.comp.sort.diff': 'By Biggest Diff',
    'wdr.comp.sort.freq': 'By Freq Diff',
    'wdr.comp.uniqueId': 'Unique ID',
    'wdr.comp.action': 'Action',
    'wdr.comp.empty': 'Upload a Baseline report and at least one Target report to start comparison.',
    'wdr.comp.sqlDetail': 'SQL Comparison',
    'wdr.comp.sqlText': 'SQL Text',
    'wdr.comp.perfComp': 'Performance Comparison',
    'wdr.comp.notFound': 'Not found',
    'wdr.comp.metric.calls': 'Executions',
    'wdr.comp.metric.total': 'Total Time',
    'wdr.comp.metric.avg': 'Avg Time',
    'wdr.comp.metric.cpu': 'CPU Time',
    'wdr.comp.metric.io': 'IO Time',
    'wdr.comp.metric.rows': 'Rows',
    'wdr.comp.metric.lread': 'Logical Reads',
    'wdr.comp.metric.cps': 'Exec Freq (Calls/s)',
    'wdr.comp.user': 'User',

    // Thresholds
    'thr.categories': 'Categories',
    'thr.config': 'Configuration',
    'thr.batchSave': 'Batch Save',
    'thr.templates': 'Templates',
    'thr.sysTemplates': 'System Templates',
    'thr.customTemplates': 'Custom Templates',
    'thr.key': 'Key',
    'thr.value': 'Value',
    'thr.unit': 'Unit',
    'thr.range': 'Range',
    'thr.action': 'Action',

    // SQL Audit
    'audit.all': 'All',
    'audit.pending': 'Pending',
    'audit.processing': 'Processing',
    'audit.fixed': 'Fixed',
    'audit.whitelisted': 'Whitelisted',
    'audit.id': 'Issue ID',
    'audit.severity': 'Severity',
    'audit.type': 'Type',
    'audit.target': 'Target',
    'audit.foundTime': 'Found Time',
    'audit.status': 'Status',
    'audit.actions': 'Actions',
    'audit.optimize': 'Optimize',
    'audit.modalTitle': 'SQL Optimization',
    'audit.issueId': 'Issue ID',
    'audit.targetSql': 'Target SQL',
    'audit.diagnosis': 'Diagnosis',
    'audit.recommendation': 'Recommendation',
    'audit.cancel': 'Cancel',
    'audit.whitelist': 'Whitelist',
    'audit.apply': 'Apply',

    // Audit Log
    'log.allOps': 'All Operations',
    'log.updateThr': 'Update Threshold',
    'log.export': 'Export',
    'log.time': 'Time',
    'log.user': 'User',
    'log.op': 'Operation',
    'log.target': 'Target',
    'log.result': 'Result',

    // WDR Analyze
    'wdr.kb.title': 'WDR Knowledge Base',
    'wdr.kb.search': 'Search metrics...',
    'wdr.kb.efficiency.title': 'Instance Efficiency Percentages',
    'wdr.kb.efficiency.desc': 'Target is 100%. The closer to 100%, the healthier the database.',
    'wdr.kb.bufferHit.title': 'Buffer Hit',
    'wdr.kb.bufferHit.desc': 'The ratio of data requests found in buffer. Higher values indicate better read performance.',
    'wdr.kb.effectiveCpu.title': 'Effective CPU',
    'wdr.kb.effectiveCpu.desc': 'Ratio of effective CPU usage. Low values indicate high wait states.',
    'wdr.kb.walWrite.title': 'WalWrite NoWait',
    'wdr.kb.walWrite.desc': 'Ratio of WAL writes without waiting. <100% implies need for larger buffer.',
    'wdr.kb.softParse.title': 'Soft Parse',
    'wdr.kb.softParse.desc': 'Ratio of soft parses. Low values indicate hard parsing (expensive).',
    'wdr.kb.nonParseCpu.title': 'Non-Parse CPU',
    'wdr.kb.nonParseCpu.desc': 'Ratio of CPU not used for parsing. High is better.',
    'wdr.issue.bufferHit': 'Low Buffer Hit Ratio',
    'wdr.issue.bufferHitDesc': 'Buffer Hit Ratio is {val}%, which is lower than the recommended 95%.',
    'wdr.issue.cpu': 'High CPU Usage',
    'wdr.issue.cpuDesc': 'CPU usage is consistently high compared to DB Time.',
    'wdr.issue.deadTup': 'Table Bloat (Dead Tuples)',
    'wdr.issue.deadTupDesc': 'Table {table} has {count} dead tuples, exceeding threshold.',
    'wdr.issue.slowSql': 'Slow SQL Detected',
    'wdr.issue.slowSqlDesc': 'SQL {id} takes {time}ms on average.',
    'wdr.analyzing': 'Analyzing WDR Report...',
    'wdr.upload.title': 'Upload WDR Report',
    'wdr.upload.desc': 'Drag and drop your OpenGauss WDR HTML report here, or click to browse.',
    'wdr.upload.btn': 'Select Report',
    'wdr.upload.drag': 'Supports .html and .wdr formats',
    'wdr.score': 'Health Score',
    'wdr.risk.none': 'No major risks detected.',
    'wdr.tab.overview': 'Overview',
    'wdr.tab.wait': 'Wait Events',
    'wdr.tab.sql': 'Top SQL',
    'wdr.tab.obj': 'Object Stats',
    'wdr.tab.settings': 'Settings',

    'desc.wait.LockMgrLock': 'Waiting for a lock on a relation or object. High values indicate contention.',
    'desc.wait.WALSync': 'Waiting for WAL flush to disk. High values usually indicate disk I/O bottleneck.',
    'desc.wait.DataFileRead': 'Waiting for data block read from disk.',
    'desc.wait.DataFileWrite': 'Waiting for data write to disk.',

    // Visualizer
    'vis.title': 'Plan Visualizer',
    'vis.explain': 'Explain',
    'vis.sqlEditor': 'SQL Editor',
    'vis.syntax': 'GaussDB Syntax',
    'vis.pastePlaceholder': '-- Paste your SQL query here...',
    'vis.planText': 'Plan Text',
    'vis.visualTree': 'Visual Tree',
    'vis.totalCost': 'Total Cost',
    'vis.analyzing': 'Analyzing Plan...',
    'vis.selectSql': 'Select SQL',
    'vis.opt.suggestions': 'Optimization Suggestions',
    'vis.node.cost': 'Cost',
    'vis.node.rows': 'Rows',
    
    // KB Visualizer
    'vis.kb.title': 'Plan Knowledge Base',
    'vis.kb.search': 'Search operators...',
    'vis.kb.diskSpill.title': 'Disk Spill',
    'vis.kb.diskSpill.desc': 'Operation spilled to disk due to insufficient memory (work_mem).',
    'vis.kb.nestLoop.title': 'Nested Loop',
    'vis.kb.nestLoop.desc': 'Joins two tables by looping over every row in the outer table and finding matches in the inner table.',
    'vis.kb.nestLoop.pros': 'Efficient for small outer tables.',
    'vis.kb.nestLoop.cons': 'Very slow for large tables without indexes.',
    'vis.kb.userFunc.title': 'User Function',
    'vis.kb.userFunc.desc': 'Execution of a user-defined function.',
    'vis.kb.userFunc.pros': 'Encapsulates logic.',
    'vis.kb.userFunc.cons': 'Can be a black box for optimizer; high CPU.',
    'vis.kb.rownum.title': 'Rownum',
    'vis.kb.rownum.desc': 'Limiting result set using rownum.',
    'vis.kb.idxOnlyScan.title': 'Index Only Scan',
    'vis.kb.idxOnlyScan.desc': 'Scanning index only, no heap access needed.',
    'vis.kb.bitmapScan.title': 'Bitmap Scan',
    'vis.kb.bitmapScan.desc': 'Scanning index to build a bitmap of pages, then reading pages.',
    'vis.kb.partIter.title': 'Partition Iterator',
    'vis.kb.partIter.desc': 'Iterating over partitions.',
    'vis.kb.idxScan.title': 'Index Scan',
    'vis.kb.idxScan.desc': 'Scanning an index.',
    'vis.kb.seqScan.title': 'Seq Scan',
    'vis.kb.seqScan.desc': 'Sequential scan of the table.',
    'vis.kb.cteScan.title': 'CTE Scan',
    'vis.kb.cteScan.desc': 'Scanning a Common Table Expression.',
    'vis.kb.subqueryScan.title': 'Subquery Scan',
    'vis.kb.subqueryScan.desc': 'Scanning a subquery.',
    'vis.kb.hashJoin.title': 'Hash Join',
    'vis.kb.hashJoin.desc': 'Joins by hashing one table and probing with the other.',
    'vis.kb.mergeJoin.title': 'Merge Join',
    'vis.kb.mergeJoin.desc': 'Joins two sorted inputs.',
    'vis.kb.append.title': 'Append',
    'vis.kb.append.desc': 'Combines results from multiple sets.',
    'vis.kb.result.title': 'Result',
    'vis.kb.result.desc': 'Returns a constant or expression.',
    'vis.kb.materialize.title': 'Materialize',
    'vis.kb.materialize.desc': 'Stores result of sub-step in memory/disk.',
    'vis.kb.agg.title': 'Aggregate',
    'vis.kb.agg.desc': 'Grouping or aggregation operation.',
    'vis.kb.sort.title': 'Sort',
    'vis.kb.sort.desc': 'Sorting rows.',
    'vis.kb.limit.title': 'Limit',
    'vis.kb.limit.desc': 'Limiting rows returned.',

    // Plan Hints KB
    'vis.kb.hintLeading.title': 'Join Order Hint (leading)',
    'vis.kb.hintLeading.desc': 'Specifies the join order of tables. E.g., leading(t1 t2) forces t1 to join t2. Useful when optimizer picks inefficient join paths.',
    'vis.kb.hintLeading.pros': 'Fixes inefficient join orders.',
    'vis.kb.hintLeading.cons': 'May prevent better plans if data distribution changes.',

    'vis.kb.hintJoinMethod.title': 'Join Method Hint',
    'vis.kb.hintJoinMethod.desc': 'Forces a specific join algorithm (nestloop, hashjoin, mergejoin). E.g., nestloop(t1 t2).',
    'vis.kb.hintJoinMethod.pros': 'Optimizes specific scenarios (e.g., small table nestloop).',
    'vis.kb.hintJoinMethod.cons': 'Risk of severe performance drop if wrongly applied.',

    'vis.kb.hintRows.title': 'Rows Hint',
    'vis.kb.hintRows.desc': 'Adjusts cardinality estimates. Supports absolute (#) or relative (+, -, *) adjustments.',
    'vis.kb.hintRows.pros': 'Corrects bad estimates influencing plan choice.',
    'vis.kb.hintRows.cons': 'Requires manual tuning; may become stale.',

    'vis.kb.hintScan.title': 'Scan Method Hint',
    'vis.kb.hintScan.desc': 'Forces scan type (tablescan, indexscan, indexonlyscan, bitmapscan).',
    'vis.kb.hintScan.pros': 'Forces index usage when optimizer prefers seq scan.',
    'vis.kb.hintScan.cons': 'Index scan on large portion of table can be slower.',

    'vis.kb.hintStream.title': 'Stream Hint',
    'vis.kb.hintStream.desc': 'Controls data distribution (broadcast, redistribute) in parallel plans.',
    'vis.kb.hintStream.pros': 'Optimizes data movement in cluster.',
    'vis.kb.hintStream.cons': 'Only effective for parallel/distributed plans.',

    'vis.kb.hintBlock.title': 'Blockname Hint',
    'vis.kb.hintBlock.desc': 'Names a query block or sub-link for reference in other hints.',
    'vis.kb.hintBlock.pros': 'Enables hinting of complex subqueries.',
    'vis.kb.hintBlock.cons': 'Complexity in managing block names.',

    'vis.kb.hintOther.title': 'Other Hints',
    'vis.kb.hintOther.desc': 'Includes no_expand, no_gpc, predpush, wlmrule, etc.',
    'vis.kb.hintOther.pros': 'Fine-grained control over optimizer behavior.',
    'vis.kb.hintOther.cons': 'Advanced usage only.',
    
    // Visualizer Rules
    'vis.rule.001.title': 'High Total Cost',
    'vis.rule.001.desc': 'Plan total cost ({cost}) exceeds threshold.',
    'vis.rule.001.sugg': 'Check for missing indexes or complex joins.',
    'vis.rule.006.title': 'Long Execution Time',
    'vis.rule.006.desc': 'Actual execution time ({time}ms) is high.',
    'vis.rule.006.sugg': 'Identify bottleneck nodes in the plan.',
    'vis.rule.002.title': 'Large Seq Scan',
    'vis.rule.002.desc': 'Sequential scan on large table.',
    'vis.rule.002.sugg': 'Consider adding an index.',
    'vis.rule.003.title': 'SubPlan Found',
    'vis.rule.003.desc': 'SubPlan usage detected.',
    'vis.rule.003.sugg': 'Rewrite as join if possible.',
    'vis.rule.004.title': 'Cartesian Product',
    'vis.rule.004.desc': 'Potential Cartesian product (Nested Loop without index).',
    'vis.rule.004.sugg': 'Ensure join conditions are correct.',
    'vis.rule.005.title': 'Many Partitions Scanned',
    'vis.rule.005.desc': 'Scanning many partitions.',
    'vis.rule.005.sugg': 'Check partition pruning.',
    'vis.rule.007.title': 'Bitmap Scan',
    'vis.rule.007.desc': 'Bitmap scan used.',
    'vis.rule.007.sugg': 'Check if simple Index Scan is better.',
    'vis.rule.008.title': 'Disk Spill',
    'vis.rule.008.desc': 'Operation spilled to disk.',
    'vis.rule.008.sugg': 'Increase work_mem.',
    'vis.rule.009.title': 'Index Scan Filter',
    'vis.rule.009.desc': 'Index scan with filter.',
    'vis.rule.009.sugg': 'Include filter columns in index.',
    'vis.rule.011.title': 'User Function',
    'vis.rule.011.desc': 'User function in plan.',
    'vis.rule.011.sugg': 'Check function performance.',
    'vis.rule.012.title': 'Complex Update',
    'vis.rule.012.desc': 'Update with many subqueries.',
    'vis.rule.012.sugg': 'Simplify update logic.',
    'vis.rule.013.title': 'Rownum Limit',
    'vis.rule.013.desc': 'Rownum used on large set.',
    'vis.rule.013.sugg': 'Use LIMIT/OFFSET instead.',

    // Diff
    'diff.title': 'Plan Diff',
    'diff.loadSample': 'Load Sample',
    'diff.compare': 'Compare',
    'diff.mode.unified': 'Unified Input',
    'diff.mode.split': 'Split Input',
    'diff.tip.unified': 'Paste both plans here. The tool will auto-split them.',
    'diff.placeholder.unified': 'Paste full text containing both plans...',
    'diff.placeholder.left': 'Paste Baseline Plan...',
    'diff.placeholder.right': 'Paste Target Plan...',
    'diff.verdict.improved': 'Improved',
    'diff.verdict.regressed': 'Regressed',
    'diff.verdict.similar': 'Similar',
    'diff.verdict.new': 'New',
    'diff.verdict.removed': 'Removed',
    'diff.metric.execTime': 'Exec Time',
    'diff.metric.time': 'Time',
    'diff.baseline': 'Baseline',
    'diff.target': 'Target',
    'diff.col.operation': 'Operation',
    'diff.col.costTime': 'Cost/Time',
    'diff.col.rows': 'Rows',
    'diff.col.costPct': 'Cost %',
    'diff.risk.diskSpill': 'Disk Spill Detected',
    'diff.risk.largeSeqScan': 'Large Seq Scan ({rows}k rows)',
    'diff.risk.highCost': 'Very High Cost',
    'diff.risk.nestLoop': 'Nested Loop on large set',
    'diff.risk.badEst': 'Significant Rows Misestimate',
    'diff.analysis.title': 'Risk Analysis',
    'diff.analysis.newRisk': 'New Risk: {risk}',
    'diff.analysis.resolved': 'Resolved: {risk}',
  },
  zh: {
    // Menu
    'menu.dashboard': '仪表盘',
    'menu.wdrAnalyze': 'WDR 分析',
    'menu.wdrComparison': 'WDR 对比',
    'menu.reports': '报告管理',
    'menu.comparison': '性能比对',
    'menu.visualizer': '计划可视化',
    'menu.plandiff': '计划比对',
    'menu.thresholds': '阈值配置',
    'menu.sqlaudit': 'SQL 审核',
    'menu.auditlog': '审计日志',
    'header.role': '管理员',

    // Dashboard
    'dash.lastReport': '最新报告',
    'dash.healthy': '健康',
    'dash.warning': '警告',
    'dash.critical': '严重',
    'dash.score': '健康分',
    'dash.activeIssues': '活跃问题',
    'dash.allInstances': '所有实例',
    'dash.instanceOverview': '实例概览',
    'dash.cpu': 'CPU 使用率',
    'dash.mem': '内存使用率',
    'dash.tps': 'TPS',
    'dash.qps': 'QPS',
    'dash.health': '健康分布',
    'dash.trend': '性能趋势',
    'dash.hotIssues': '热点问题',
    'dash.details': '详情',
    'dash.recentReports': '最近报告',
    'dash.view': '查看',

    // Reports
    'rep.search': '搜索实例...',
    'rep.upload': '上传报告',
    'rep.id': '报告 ID',
    'rep.instance': '实例',
    'rep.generated': '生成时间',
    'rep.period': '时间段',
    'rep.status': '状态',
    'rep.actions': '操作',
    'rep.loading': '加载报告中...',
    'rep.showing': '显示 {start}-{end} 共 {total}',
    'rep.prev': '上一页',
    'rep.next': '下一页',
    'rep.uploadTitle': '上传 WDR 报告',
    'rep.instanceName': '实例名称',
    'rep.desc': '描述',
    'rep.file': '报告文件',
    'rep.clickUpload': '点击上传或拖拽文件到此处',
    'rep.fileHint': '支持 HTML 或 WDR 格式',
    'rep.cancel': '取消',
    'rep.submit': '提交',
    'rep.deleteTitle': '删除报告',
    'rep.deleteConfirm': '确定要删除报告 #{id} 吗？此操作不可撤销。',
    'rep.delete': '删除',
    'rep.viewTitle': '报告详情',
    'rep.tab.summary': '概览',
    'rep.tab.sqlstats': 'SQL 统计',
    'rep.tab.objstats': '对象统计',
    'rep.summary.efficiency': '效率指标',
    'rep.summary.workload': '负载概况',
    'rep.metric': '指标',
    'rep.perSec': '每秒',
    'rep.perTxn': '每事务',
    'rep.sql.orderBy': '排序',
    'rep.sql.elapsed': '耗时',
    'rep.sql.cpu': 'CPU 时间',
    'rep.sql.calls': '调用次数',
    'rep.sql.text': 'SQL 文本',
    'rep.sql.visualize': '计划可视化',
    'rep.obj.seqScan': '全表扫描',
    'rep.obj.idxScan': '索引扫描',
    'rep.obj.liveTup': '活元组',
    'rep.obj.deadTup': '死元组',

    // Comparison (General)
    'comp.tab.sql': 'Top SQL',
    'comp.tab.wait': '等待事件',
    'comp.tab.obj': '对象统计',
    'comp.tab.sys': '系统指标',
    'comp.fingerprint': '指纹',
    'comp.r1': '报告 1',
    'comp.r2': '报告 2',
    'comp.change': '变化',
    'comp.col.cpu': 'CPU 时间',
    'comp.col.io': 'IO 时间',
    'comp.col.phyRd': '物理读',
    'comp.col.logRd': '逻辑读',
    'comp.action': '操作',
    'comp.plan': '计划',
    'comp.col.event': '事件',
    'comp.col.class': '类型',
    'comp.col.object': '对象',
    'comp.col.schema': '模式',
    'comp.col.diff': '差异',
    'comp.col.heapRd': '堆读',
    'comp.col.heapHit': '堆命中',
    'comp.col.idxRd': '索引读',
    'comp.col.idxHit': '索引命中',
    'comp.col.tup': '元组 (增/改/删)',
    'comp.col.metric': '指标',
    'comp.summary.title': '比对摘要',
    'comp.status.degraded': '恶化',
    'comp.status.improved': '改善',
    'comp.status.stable': '稳定',
    'comp.summary.score': '分数变化',
    'comp.summary.conclusion': '结论',
    'comp.summary.findings': '主要发现',
    'comp.overview.title': '概览',
    'comp.chart.dbTime': 'DB Time',
    'comp.chart.cpu': 'CPU',
    'comp.chart.io': 'IOPS',
    'comp.selected': '已选报告',
    'comp.new': '新建比对',
    'comp.name': '比对名称',
    'comp.desc': '描述',
    'comp.save': '保存',

    // WDR Comparison Specific
    'wdr.comp.title': 'WDR 对比分析',
    'wdr.comp.reset': '重置所有',
    'wdr.comp.baseline': '基准报告',
    'wdr.comp.target': '对比报告',
    'wdr.comp.uploadBase': '上传基准 WDR',
    'wdr.comp.addTarget': '添加对比报告',
    'wdr.comp.keyMetrics': '关键指标',
    'wdr.comp.topWait': 'Top 等待事件',
    'wdr.comp.topSql': 'Top 20 SQL',
    'wdr.comp.eventName': '事件名称',
    'wdr.comp.baseWaits': '基准等待次数',
    'wdr.comp.baseAvg': '基准平均(us)',
    'wdr.comp.baseMax': '基准最大(us)',
    'wdr.comp.waits': '等待次数',
    'wdr.comp.avg': '平均',
    'wdr.comp.max': '最大',
    'wdr.comp.sort.total': '按总耗时',
    'wdr.comp.sort.avg': '按平均耗时',
    'wdr.comp.sort.diff': '按差异幅度',
    'wdr.comp.sort.freq': '按频率变化',
    'wdr.comp.uniqueId': '唯一 ID',
    'wdr.comp.action': '操作',
    'wdr.comp.empty': '请上传一份基准报告和至少一份对比报告以开始分析。',
    'wdr.comp.sqlDetail': 'SQL 对比详情',
    'wdr.comp.sqlText': 'SQL 文本',
    'wdr.comp.perfComp': '性能指标对比',
    'wdr.comp.notFound': '未找到',
    'wdr.comp.metric.calls': '执行次数',
    'wdr.comp.metric.total': '总耗时',
    'wdr.comp.metric.avg': '平均耗时',
    'wdr.comp.metric.cpu': 'CPU 时间',
    'wdr.comp.metric.io': 'IO 时间',
    'wdr.comp.metric.rows': '行数',
    'wdr.comp.metric.lread': '逻辑读',
    'wdr.comp.metric.cps': '执行频率 (次/秒)',
    'wdr.comp.user': '用户',

    // Thresholds
    'thr.categories': '分类',
    'thr.config': '配置',
    'thr.batchSave': '批量保存',
    'thr.templates': '模板',
    'thr.sysTemplates': '系统模板',
    'thr.customTemplates': '自定义模板',
    'thr.key': '键',
    'thr.value': '值',
    'thr.unit': '单位',
    'thr.range': '推荐范围',
    'thr.action': '操作',

    // SQL Audit
    'audit.all': '全部',
    'audit.pending': '待处理',
    'audit.processing': '处理中',
    'audit.fixed': '已修复',
    'audit.whitelisted': '已白名单',
    'audit.id': '问题 ID',
    'audit.severity': '严重程度',
    'audit.type': '类型',
    'audit.target': '对象',
    'audit.foundTime': '发现时间',
    'audit.status': '状态',
    'audit.actions': '操作',
    'audit.optimize': '优化',
    'audit.modalTitle': 'SQL 优化建议',
    'audit.issueId': '问题 ID',
    'audit.targetSql': '目标 SQL',
    'audit.diagnosis': '诊断',
    'audit.recommendation': '建议',
    'audit.cancel': '取消',
    'audit.whitelist': '加入白名单',
    'audit.apply': '应用',

    // Audit Log
    'log.allOps': '所有操作',
    'log.updateThr': '更新阈值',
    'log.export': '导出',
    'log.time': '时间',
    'log.user': '用户',
    'log.op': '操作',
    'log.target': '对象',
    'log.result': '结果',

    // WDR Analyze
    'wdr.kb.title': 'WDR 知识库',
    'wdr.kb.search': '搜索指标...',
    'wdr.kb.efficiency.title': '实例效率百分比',
    'wdr.kb.efficiency.desc': '目标值是100%，即越接近100%，数据库运行越健康。',
    'wdr.kb.bufferHit.title': 'Buffer Hit (缓存命中率)',
    'wdr.kb.bufferHit.desc': '数据库请求在Buffer中命中的比例。越高代表性能越好。',
    'wdr.kb.effectiveCpu.title': 'Effective CPU (有效CPU)',
    'wdr.kb.effectiveCpu.desc': '有效CPU使用比例。偏小说明等待状态比例较高。',
    'wdr.kb.walWrite.title': 'WalWrite NoWait',
    'wdr.kb.walWrite.desc': 'WAL写不等待比例。小于100%可能需要调大buffer。',
    'wdr.kb.softParse.title': 'Soft Parse (软解析)',
    'wdr.kb.softParse.desc': 'SQL软解析比例。偏小说明存在大量硬解析。',
    'wdr.kb.nonParseCpu.title': 'Non-Parse CPU',
    'wdr.kb.nonParseCpu.desc': '非解析占用CPU比例。',
    'wdr.issue.bufferHit': '缓存命中率低',
    'wdr.issue.bufferHitDesc': 'Buffer Hit 为 {val}%，低于建议值 95%。',
    'wdr.issue.cpu': 'CPU 使用率高',
    'wdr.issue.cpuDesc': '相对于 DB Time，CPU 使用率持续偏高。',
    'wdr.issue.deadTup': '表膨胀 (死元组)',
    'wdr.issue.deadTupDesc': '表 {table} 包含 {count} 个死元组，超过阈值。',
    'wdr.issue.slowSql': '慢 SQL',
    'wdr.issue.slowSqlDesc': 'SQL {id} 平均耗时 {time}ms。',
    'wdr.analyzing': '正在分析 WDR 报告...',
    'wdr.upload.title': '上传 WDR 报告',
    'wdr.upload.desc': '拖拽 OpenGauss WDR HTML 报告到此处，或点击浏览。',
    'wdr.upload.btn': '选择报告',
    'wdr.upload.drag': '支持 .html 和 .wdr 格式',
    'wdr.score': '健康分',
    'wdr.risk.none': '未发现主要风险。',
    'wdr.tab.overview': '概览',
    'wdr.tab.wait': '等待事件',
    'wdr.tab.sql': 'Top SQL',
    'wdr.tab.obj': '对象统计',
    'wdr.tab.settings': '数据库参数',

    // WDR Comparison
    'desc.wait.LockMgrLock': '正在等待关系或对象上的锁。值较高表示存在锁争用。',
    'desc.wait.WALSync': '等待 WAL 刷盘。值较高通常表示磁盘 I/O 瓶颈。',
    'desc.wait.DataFileRead': '等待从磁盘读取数据块。',
    'desc.wait.DataFileWrite': '等待数据写入磁盘。',

    // Visualizer
    'vis.title': '执行计划可视化',
    'vis.explain': 'Explain',
    'vis.sqlEditor': 'SQL 编辑器',
    'vis.syntax': 'GaussDB 语法',
    'vis.pastePlaceholder': '-- 在此粘贴 SQL ...',
    'vis.planText': '计划文本',
    'vis.visualTree': '可视化树',
    'vis.totalCost': '总代价',
    'vis.analyzing': '分析计划中...',
    'vis.selectSql': '选择 SQL',
    'vis.opt.suggestions': '优化建议',
    'vis.node.cost': '代价',
    'vis.node.rows': '行数',

    // KB Visualizer
    'vis.kb.title': '计划知识库',
    'vis.kb.search': '搜索算子...',
    'vis.kb.diskSpill.title': '下盘 (Disk Spill)',
    'vis.kb.diskSpill.desc': '由于内存不足(work_mem)，操作溢出到磁盘。',
    'vis.kb.nestLoop.title': 'Nested Loop (嵌套循环)',
    'vis.kb.nestLoop.desc': '通过循环外表并在内表中寻找匹配来连接两个表。',
    'vis.kb.nestLoop.pros': '外表较小时效率高。',
    'vis.kb.nestLoop.cons': '如果表很大且无索引，效率极低。',
    'vis.kb.userFunc.title': '用户函数',
    'vis.kb.userFunc.desc': '执行用户自定义函数。',
    'vis.kb.userFunc.pros': '封装逻辑。',
    'vis.kb.userFunc.cons': '优化器黑盒，可能导致高 CPU。',
    'vis.kb.rownum.title': 'Rownum',
    'vis.kb.rownum.desc': '使用 rownum 限制结果集。',
    'vis.kb.idxOnlyScan.title': 'Index Only Scan',
    'vis.kb.idxOnlyScan.desc': '只扫描索引，无需回表。',
    'vis.kb.bitmapScan.title': 'Bitmap Scan',
    'vis.kb.bitmapScan.desc': '扫描索引生成位图，再读取页面。',
    'vis.kb.partIter.title': 'Partition Iterator',
    'vis.kb.partIter.desc': '分区迭代。',
    'vis.kb.idxScan.title': 'Index Scan',
    'vis.kb.idxScan.desc': '索引扫描。',
    'vis.kb.seqScan.title': 'Seq Scan',
    'vis.kb.seqScan.desc': '全表顺序扫描。',
    'vis.kb.cteScan.title': 'CTE Scan',
    'vis.kb.cteScan.desc': '扫描公用表表达式。',
    'vis.kb.subqueryScan.title': 'Subquery Scan',
    'vis.kb.subqueryScan.desc': '扫描子查询。',
    'vis.kb.hashJoin.title': 'Hash Join',
    'vis.kb.hashJoin.desc': '哈希连接。',
    'vis.kb.mergeJoin.title': 'Merge Join',
    'vis.kb.mergeJoin.desc': '归并连接。',
    'vis.kb.append.title': 'Append',
    'vis.kb.append.desc': '合并多个结果集。',
    'vis.kb.result.title': 'Result',
    'vis.kb.result.desc': '返回常量或表达式。',
    'vis.kb.materialize.title': 'Materialize',
    'vis.kb.materialize.desc': '物化结果。',
    'vis.kb.agg.title': 'Aggregate',
    'vis.kb.agg.desc': '聚合操作。',
    'vis.kb.sort.title': 'Sort',
    'vis.kb.sort.desc': '排序。',
    'vis.kb.limit.title': 'Limit',
    'vis.kb.limit.desc': '限制返回行数。',

    // Plan Hints KB
    'vis.kb.hintLeading.title': '连接顺序 Hint (leading)',
    'vis.kb.hintLeading.desc': '指定表的连接顺序。例如 leading(t1 t2) 强制 t1 和 t2 连接。',
    'vis.kb.hintLeading.pros': '修复优化器选择的低效连接顺序。',
    'vis.kb.hintLeading.cons': '如果数据分布变化，可能阻碍生成更好的计划。',

    'vis.kb.hintJoinMethod.title': '连接方式 Hint',
    'vis.kb.hintJoinMethod.desc': '强制特定的连接算法 (nestloop, hashjoin, mergejoin)。例如 nestloop(t1 t2)。',
    'vis.kb.hintJoinMethod.pros': '优化特定场景（如小表嵌套循环）。',
    'vis.kb.hintJoinMethod.cons': '如果误用可能导致严重的性能下降。',

    'vis.kb.hintRows.title': '行数 Hint (rows)',
    'vis.kb.hintRows.desc': '调整基数估算。支持绝对值(#)或相对值(+,-,*)调整。',
    'vis.kb.hintRows.pros': '纠正影响计划选择的错误估算。',
    'vis.kb.hintRows.cons': '需要手动调整，数据变化后可能失效。',

    'vis.kb.hintScan.title': '扫描方式 Hint',
    'vis.kb.hintScan.desc': '强制扫描类型 (tablescan, indexscan, indexonlyscan, bitmapscan)。',
    'vis.kb.hintScan.pros': '当优化器倾向于全表扫描时强制使用索引。',
    'vis.kb.hintScan.cons': '对大比例数据的索引扫描可能更慢。',

    'vis.kb.hintStream.title': 'Stream Hint',
    'vis.kb.hintStream.desc': '控制并行计划中的数据分布 (broadcast, redistribute)。',
    'vis.kb.hintStream.pros': '优化集群内的数据移动。',
    'vis.kb.hintStream.cons': '仅在并行/分布式计划中有效。',

    'vis.kb.hintBlock.title': 'Blockname Hint',
    'vis.kb.hintBlock.desc': '命名查询块或子链接，以便在其他 Hint 中引用。',
    'vis.kb.hintBlock.pros': '支持对复杂子查询进行 Hint。',
    'vis.kb.hintBlock.cons': '管理块名称较为复杂。',

    'vis.kb.hintOther.title': '其他 Hint',
    'vis.kb.hintOther.desc': '包含 no_expand, no_gpc, predpush, wlmrule 等。',
    'vis.kb.hintOther.pros': '对优化器行为进行精细控制。',
    'vis.kb.hintOther.cons': '仅限高级用法。',

    // Visualizer Rules
    'vis.rule.001.title': '总代价过高',
    'vis.rule.001.desc': '计划总代价 ({cost}) 超过阈值。',
    'vis.rule.001.sugg': '检查是否缺少索引或存在复杂连接。',
    'vis.rule.006.title': '执行时间长',
    'vis.rule.006.desc': '实际执行时间 ({time}ms) 较长。',
    'vis.rule.006.sugg': '定位计划中的瓶颈算子。',
    'vis.rule.002.title': '大表全表扫描',
    'vis.rule.002.desc': '对大表进行了全表扫描。',
    'vis.rule.002.sugg': '考虑添加索引。',
    'vis.rule.003.title': '发现 SubPlan',
    'vis.rule.003.desc': '使用了 SubPlan。',
    'vis.rule.003.sugg': '尽可能改写为 Join。',
    'vis.rule.004.title': '笛卡尔积',
    'vis.rule.004.desc': '可能存在笛卡尔积 (无索引的 Nested Loop)。',
    'vis.rule.004.sugg': '确保连接条件正确。',
    'vis.rule.005.title': '扫描分区过多',
    'vis.rule.005.desc': '扫描了大量分区。',
    'vis.rule.005.sugg': '检查分区剪枝是否生效。',
    'vis.rule.007.title': 'Bitmap Scan',
    'vis.rule.007.desc': '使用了 Bitmap Scan。',
    'vis.rule.007.sugg': '检查普通 Index Scan 是否更优。',
    'vis.rule.008.title': '下盘 (Disk Spill)',
    'vis.rule.008.desc': '操作溢出到磁盘。',
    'vis.rule.008.sugg': '增加 work_mem。',
    'vis.rule.009.title': '索引扫描带过滤',
    'vis.rule.009.desc': '索引扫描包含过滤条件。',
    'vis.rule.009.sugg': '将过滤列加入索引。',
    'vis.rule.011.title': '用户函数',
    'vis.rule.011.desc': '计划中包含用户函数。',
    'vis.rule.011.sugg': '检查函数性能。',
    'vis.rule.012.title': '复杂更新',
    'vis.rule.012.desc': 'Update 包含多个子查询。',
    'vis.rule.012.sugg': '简化更新逻辑。',
    'vis.rule.013.title': 'Rownum 限制',
    'vis.rule.013.desc': '在大结果集上使用 Rownum。',
    'vis.rule.013.sugg': '使用 LIMIT/OFFSET 代替。',

    // Diff
    'diff.title': '计划比对',
    'diff.loadSample': '加载示例',
    'diff.compare': '比对',
    'diff.mode.unified': '统一输入',
    'diff.mode.split': '分栏输入',
    'diff.tip.unified': '在此粘贴两个计划，工具会自动拆分。',
    'diff.placeholder.unified': '粘贴包含两个计划的完整文本...',
    'diff.placeholder.left': '粘贴基准计划...',
    'diff.placeholder.right': '粘贴目标计划...',
    'diff.verdict.improved': '改善',
    'diff.verdict.regressed': '恶化',
    'diff.verdict.similar': '相似',
    'diff.verdict.new': '新增',
    'diff.verdict.removed': '移除',
    'diff.metric.execTime': '执行时间',
    'diff.metric.time': '时间',
    'diff.baseline': '基准',
    'diff.target': '目标',
    'diff.col.operation': '操作',
    'diff.col.costTime': '代价/时间',
    'diff.col.rows': '行数',
    'diff.col.costPct': '代价占比',
    'diff.risk.diskSpill': '检测到下盘',
    'diff.risk.largeSeqScan': '大表全表扫描 ({rows}k 行)',
    'diff.risk.highCost': '代价极高',
    'diff.risk.nestLoop': '大数据量嵌套循环',
    'diff.risk.badEst': '行数估算严重偏差',
    'diff.analysis.title': '风险分析',
    'diff.analysis.newRisk': '新增风险: {risk}',
    'diff.analysis.resolved': '已解决: {risk}',
  }
};

export const I18nProvider: React.FC<{ children: ReactNode }> = ({ children }) => {
  const [language, setLanguage] = useState<Language>('zh'); // Default to Chinese

  const t = useCallback((key: string, params?: Record<string, string | number>) => {
    let text = translations[language][key] || key;
    if (params) {
      Object.entries(params).forEach(([k, v]) => {
        text = text.replace(`{${k}}`, String(v));
      });
    }
    return text;
  }, [language]);

  return (
    <I18nContext.Provider value={{ language, setLanguage, t }}>
      {children}
    </I18nContext.Provider>
  );
};

export const useI18n = () => {
  const context = useContext(I18nContext);
  if (!context) {
    throw new Error('useI18n must be used within an I18nProvider');
  }
  return context;
};
