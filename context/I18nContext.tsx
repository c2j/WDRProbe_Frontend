
import React, { createContext, useState, useContext, ReactNode, useEffect } from 'react';

type Language = 'en' | 'zh';

const translations = {
  en: {
    // Menu
    'menu.dashboard': 'Dashboard',
    'menu.reports': 'WDR Reports',
    'menu.comparison': 'Comparison',
    'menu.visualizer': 'Plan Visualizer',
    'menu.plandiff': 'Plan Comparison',
    'menu.thresholds': 'Thresholds',
    'menu.sqlaudit': 'SQL Audit',
    'menu.auditlog': 'Audit Logs',
    
    // Header
    'header.role': 'DBA Admin',
    
    // Dashboard
    'dash.cpu': 'CPU Usage',
    'dash.mem': 'Memory Usage',
    'dash.tps': 'TPS',
    'dash.qps': 'QPS',
    'dash.health': 'Instance Health',
    'dash.trend': 'Top Issue Trend (Today)',
    'dash.hotIssues': 'Top 10 Hot Issues',
    'dash.recentReports': 'Recent WDR Reports',
    'dash.view': 'View',
    'dash.details': 'Details',
    'dash.healthy': 'Healthy',
    'dash.warning': 'Warning',
    'dash.critical': 'Critical',
    'dash.instanceOverview': 'Instance Overview',
    'dash.selectInstance': 'Select Instance',
    'dash.allInstances': 'All Instances',
    'dash.lastReport': 'Last Report',
    'dash.activeIssues': 'Active Issues',
    'dash.score': 'Health Score',

    // Reports
    'rep.search': 'Search Instance...',
    'rep.upload': 'Upload Report',
    'rep.id': 'ID',
    'rep.instance': 'Instance',
    'rep.generated': 'Generated At',
    'rep.period': 'Period',
    'rep.status': 'Status',
    'rep.actions': 'Actions',
    'rep.loading': 'Loading...',
    'rep.uploadTitle': 'Upload WDR Report',
    'rep.instanceName': 'Instance Name',
    'rep.desc': 'Description (Optional)',
    'rep.file': 'Report File',
    'rep.clickUpload': 'Click to upload or drag and drop',
    'rep.fileHint': 'HTML or WDR files up to 50MB',
    'rep.cancel': 'Cancel',
    'rep.submit': 'Upload Report',
    'rep.showing': 'Showing {start}-{end} of {total}',
    'rep.prev': 'Prev',
    'rep.next': 'Next',
    'rep.deleteTitle': 'Delete Report',
    'rep.deleteConfirm': 'Are you sure you want to delete report #{id}? This action cannot be undone.',
    'rep.delete': 'Delete',
    'rep.viewTitle': 'Report Details',
    'rep.tab.summary': 'Overview',
    'rep.tab.load': 'Load Profile',
    'rep.tab.sqlstats': 'SQL Statistics',
    'rep.tab.objstats': 'Object Statistics',
    'rep.summary.efficiency': 'Instance Efficiency',
    'rep.summary.workload': 'Workload Profile (Per Second)',
    'rep.summary.db': 'Database Statistics',
    'rep.metric': 'Metric',
    'rep.perSec': 'Per Second',
    'rep.perTxn': 'Per Transaction',
    'rep.sql.orderBy': 'Order By',
    'rep.sql.elapsed': 'Elapsed Time',
    'rep.sql.cpu': 'CPU Time',
    'rep.sql.calls': 'Executions',
    'rep.sql.reads': 'Physical Reads',
    'rep.sql.text': 'Full SQL Text',
    'rep.sql.visualize': 'Visualize Plan',
    'rep.obj.table': 'Tables',
    'rep.obj.index': 'Indexes',
    'rep.obj.deadTup': 'Dead Tuples',
    'rep.obj.liveTup': 'Live Tuples',
    'rep.obj.seqScan': 'Seq Scan',
    'rep.obj.idxScan': 'Idx Scan',

    // Comparison
    'comp.selected': 'Selected Reports',
    'comp.new': 'New Comparison',
    'comp.name': 'Comparison Name',
    'comp.desc': 'Description',
    'comp.save': 'Save',
    'comp.tab.sql': 'SQL Statistics',
    'comp.tab.wait': 'Wait Events',
    'comp.tab.obj': 'Object Stats',
    'comp.tab.sys': 'System Metrics',
    'comp.fingerprint': 'SQL Fingerprint',
    'comp.r1': 'Report 1',
    'comp.r2': 'Report 2',
    'comp.change': 'Change',
    'comp.plan': 'Plan',
    'comp.action': 'Action',
    'comp.col.event': 'Event Name',
    'comp.col.class': 'Class',
    'comp.col.time': 'Time (ms)',
    'comp.col.object': 'Object Name',
    'comp.col.schema': 'Schema',
    'comp.col.scans': 'Scans',
    'comp.col.metric': 'Metric Name',
    'comp.col.val': 'Value',
    'comp.col.diff': 'Diff',
    'comp.col.cpu': 'CPU Time',
    'comp.col.io': 'IO Time',
    'comp.col.seq': 'Seq Scan',
    'comp.col.idx': 'Idx Scan',
    'comp.col.tup': 'Tuples (I/U/D)',
    'comp.overview.title': 'Metric Comparison Overview',
    'comp.chart.dbTime': 'DB Time (s)',
    'comp.chart.cpu': 'CPU Usage (%)',
    'comp.chart.io': 'IOPS',
    'comp.col.phyRd': 'Phy Reads',
    'comp.col.logRd': 'Log Reads',
    'comp.col.heapRd': 'Heap Read',
    'comp.col.heapHit': 'Heap Hit',
    'comp.col.idxRd': 'Idx Read',
    'comp.col.idxHit': 'Idx Hit',
    
    // Comparison Summary
    'comp.summary.title': 'Analysis Summary',
    'comp.summary.conclusion': 'Conclusion',
    'comp.summary.findings': 'Key Findings',
    'comp.summary.score': 'Performance Score',
    'comp.status.improved': 'Improved',
    'comp.status.degraded': 'Degraded',
    'comp.status.stable': 'Stable',

    // Thresholds
    'thr.categories': 'Categories',
    'thr.config': 'Configuration',
    'thr.batchSave': 'Batch Save',
    'thr.templates': 'Templates',
    'thr.sysTemplates': 'System Templates',
    'thr.customTemplates': 'Custom Templates',
    'thr.key': 'Key',
    'thr.value': 'Value',
    'thr.unit': 'Unit',
    'thr.range': 'Range',
    'thr.action': 'Action',

    // SQL Audit
    'audit.all': 'All',
    'audit.pending': 'Pending',
    'audit.processing': 'Processing',
    'audit.fixed': 'Fixed',
    'audit.whitelisted': 'Whitelisted',
    'audit.id': 'ID',
    'audit.severity': 'Severity',
    'audit.type': 'Type',
    'audit.target': 'Target',
    'audit.foundTime': 'Found Time',
    'audit.status': 'Status',
    'audit.actions': 'Actions',
    'audit.optimize': 'Optimize',
    'audit.modalTitle': 'SQL Optimization',
    'audit.issueId': 'Issue ID',
    'audit.targetSql': 'Target SQL',
    'audit.diagnosis': 'Diagnosis',
    'audit.recommendation': 'Recommendation',
    'audit.apply': 'Apply Fix',
    'audit.whitelist': 'Whitelist',
    'audit.cancel': 'Cancel',

    // Audit Log
    'log.allOps': 'All Operations',
    'log.updateThr': 'Update Threshold',
    'log.export': 'Export',
    'log.time': 'Time',
    'log.user': 'User',
    'log.op': 'Operation',
    'log.target': 'Target',
    'log.result': 'Result',
    
    // Visualizer
    'vis.title': 'Execution Plan Visualizer',
    'vis.import': 'Import',
    'vis.view': 'View',
    'vis.costThreshold': 'Cost Threshold',
    'vis.explain': 'Explain',
    'vis.help': 'Guide',
    'vis.sqlEditor': 'SQL Editor',
    'vis.syntax': 'GaussDB Syntax',
    'vis.pastePlaceholder': 'Paste your SQL here...',
    'vis.planText': 'Plan Text',
    'vis.rawExplain': 'Raw Explain',
    'vis.noPlan': 'No plan generated',
    'vis.visualTree': 'Visual Tree',
    'vis.totalCost': 'Total Cost',
    'vis.analyzing': 'Analyzing Execution Plan...',
    'vis.selectSql': 'Select a SQL to visualize plan',
    'vis.node.cost': 'Cost',
    'vis.node.rows': 'Rows',
    'vis.node.width': 'Width',
    'vis.node.target': 'Target Object',
    'vis.node.details': 'Details',
    'vis.opt.suggestions': 'Optimization Suggestions',
    'vis.opt.highCost': 'High Cost Join Detected',
    'vis.opt.highCostDesc': 'The Hash Join at the root has a cost of {cost}, which exceeds the threshold. Consider checking if the join columns are indexed.',
    'vis.opt.indexOpp': 'Index Opportunity',
    'vis.opt.indexOppDesc': 'Seq Scan on \'users\' with filter. Consider creating an index.',
    'vis.opt.loadToSee': 'Load a plan to see suggestions',
    'vis.hot.title': 'WDR Top SQL',
    'vis.hot.viewFull': 'View Full Report',
    'vis.hot.preview': 'SQL Preview',
    'vis.hot.time': 'Time',
    'vis.hot.cost': 'Cost',
    'vis.hot.action': 'Action',
    'vis.hot.load': 'Load',

    // Diff
    'diff.title': 'Execution Plan Comparison',
    'diff.compare': 'Compare',
    'diff.loadSample': 'Load Sample',
    'diff.baseline': 'Baseline Plan',
    'diff.target': 'Target Plan',
    'diff.mode.unified': 'Unified Input (Smart Split)',
    'diff.mode.split': 'Split Input (Two Panes)',
    'diff.tip.unified': "Tip: Paste both plans here. We'll automatically split them by looking for headers like 'Plan 2', 'Optimized Plan', or duplicate 'id|operation' tables.",
    'diff.placeholder.unified': 'Paste baseline and optimized plans together here...',
    'diff.placeholder.left': 'Paste original execution plan here...',
    'diff.placeholder.right': 'Paste optimized execution plan here...',
    'diff.col.operation': 'Operation',
    'diff.col.costTime': 'Cost/Time',
    'diff.col.rows': 'Rows',
    'diff.col.costPct': 'Cost %',
    'diff.analysis.title': 'Risk Analysis',
    'diff.analysis.newRisk': 'New Risk: {risk}',
    'diff.analysis.resolved': 'Resolved: {risk}',
    'diff.metric.time': 'Time',
    'diff.metric.execTime': 'Execution Time',
    'diff.risk.diskSpill': 'Disk Spill Detected (High Risk)',
    'diff.risk.largeSeqScan': 'Large Seq Scan ({rows}k rows)',
    'diff.risk.highCost': 'Very High Cost (>10k)',
    'diff.risk.nestLoop': 'High Volume Nested Loop',
    'diff.risk.badEst': 'Severe Statistics Misestimation (>10x)',
    'diff.verdict.improved': 'Improved',
    'diff.verdict.regressed': 'Regressed',
    'diff.verdict.similar': 'Similar',
    'diff.verdict.new': 'New',
    'diff.verdict.removed': 'Removed',

    // Knowledge Base General
    'vis.kb.title': 'GaussDB Operator KB',
    'vis.kb.search': 'Search operators or risks...',
    'vis.kb.pros': 'Advice (Action)',
    'vis.kb.cons': 'Risk (Problem)',
    
    // KB Entries (Rules 001-013 included implicitly or explicitly)
    'vis.kb.seqScan.title': 'Seq Scan',
    'vis.kb.seqScan.desc': 'Reads every row in the table. (Rule: Gauss-XN-002)',
    'vis.kb.seqScan.pros': 'OK for small tables or fetching >20% data.',
    'vis.kb.seqScan.cons': '[Mid Risk] Full table scan on large tables (>10k rows). Check for missing or inefficient indexes.',
    
    'vis.kb.idxScan.title': 'Index Scan',
    'vis.kb.idxScan.desc': 'Traverses B-Tree index. (Rule: Gauss-XN-009)',
    'vis.kb.idxScan.pros': 'Fast for high selectivity.',
    'vis.kb.idxScan.cons': '[High Risk] If followed by a Filter on index columns, it implies implicit conversion or complex expression preventing index coverage.',
    
    'vis.kb.idxOnlyScan.title': 'Index Only Scan',
    'vis.kb.idxOnlyScan.desc': 'Retrieves data directly from index.',
    'vis.kb.idxOnlyScan.pros': 'Fastest scan method. No heap access.',
    'vis.kb.idxOnlyScan.cons': 'Requires visibility map check.',
    
    'vis.kb.bitmapScan.title': 'Bitmap Scan',
    'vis.kb.bitmapScan.desc': 'Builds bitmap from index then reads heap. (Rule: Gauss-XN-007)',
    'vis.kb.bitmapScan.pros': 'Create composite index covering predicates.',
    'vis.kb.bitmapScan.cons': '[Mid Risk] If Recheck Cond rows are high but Filter removes most, index selectivity is poor.',

    'vis.kb.nestLoop.title': 'Nested Loop',
    'vis.kb.nestLoop.desc': 'Double loop join. (Rule: Gauss-XN-004)',
    'vis.kb.nestLoop.pros': 'Good for small datasets.',
    'vis.kb.nestLoop.cons': '[High Risk] If no Index Cond, it indicates a Cartesian Product! Check join conditions.',
    
    'vis.kb.hashJoin.title': 'Hash Join',
    'vis.kb.hashJoin.desc': 'Builds hash table in memory.',
    'vis.kb.hashJoin.pros': 'Standard for large joins.',
    'vis.kb.hashJoin.cons': 'Check for "Disk Spill" if work_mem is exceeded.',
    
    'vis.kb.mergeJoin.title': 'Merge Join',
    'vis.kb.mergeJoin.desc': 'Zips sorted inputs.',
    'vis.kb.mergeJoin.pros': 'Efficient for pre-sorted data.',
    'vis.kb.mergeJoin.cons': 'Requires expensive Sort if data not ordered.',
    
    'vis.kb.agg.title': 'Aggregation',
    'vis.kb.agg.desc': 'GROUP BY operations. (Rule: Gauss-XN-010)',
    'vis.kb.agg.pros': 'Summarizes data.',
    'vis.kb.agg.cons': '[High Risk] Group By might not push down to index (compare with Oracle).',
    
    'vis.kb.sort.title': 'Sort',
    'vis.kb.sort.desc': 'Sorts dataset.',
    'vis.kb.sort.pros': 'Required for Order By.',
    'vis.kb.sort.cons': 'Watch for Disk Spill (external merge).',

    'vis.kb.cteScan.title': 'CTE Scan',
    'vis.kb.cteScan.desc': 'Common Table Expression.',
    'vis.kb.cteScan.pros': 'Readability.',
    'vis.kb.cteScan.cons': 'Optimization fence preventing pushdown.',

    'vis.kb.materialize.title': 'Materialize',
    'vis.kb.materialize.desc': 'Stores sub-result.',
    'vis.kb.materialize.pros': 'Reuses data.',
    'vis.kb.materialize.cons': 'Memory usage overhead.',

    'vis.kb.limit.title': 'Limit',
    'vis.kb.limit.desc': 'Limits output rows.',
    'vis.kb.limit.pros': 'Top-N queries.',
    'vis.kb.limit.cons': 'Expensive if sort precedes it.',

    'vis.kb.subqueryScan.title': 'Subquery / SubPlan',
    'vis.kb.subqueryScan.desc': 'Subquery execution. (Rule: Gauss-XN-003, 012)',
    'vis.kb.subqueryScan.pros': 'Logic isolation. Suggest rewrite to CTE or Join.',
    'vis.kb.subqueryScan.cons': '[Mid/High Risk] Associated with unnesting failures. Update with Set Subquery causes multiple executions.',

    'vis.kb.append.title': 'Append',
    'vis.kb.append.desc': 'Combines results (UNION ALL).',
    'vis.kb.append.pros': 'Partition handling.',
    'vis.kb.append.cons': 'Sequential overhead.',

    'vis.kb.result.title': 'Result',
    'vis.kb.result.desc': 'Returns constant or scalar.',
    'vis.kb.result.pros': 'Fast.',
    'vis.kb.result.cons': 'N/A',

    'vis.kb.partIter.title': 'Partition Iterator',
    'vis.kb.partIter.desc': 'Iterates partitions. (Rule: Gauss-XN-005)',
    'vis.kb.partIter.pros': 'Pruning.',
    'vis.kb.partIter.cons': '[High Risk] If iterations are high, Partition Pruning failed. Check filter conditions.',

    'vis.kb.diskSpill.title': 'Disk Spill / Temp File',
    'vis.kb.diskSpill.desc': 'Memory insufficient, writing to disk. (Rule: Gauss-XN-008)',
    'vis.kb.diskSpill.pros': 'Allows large query completion.',
    'vis.kb.diskSpill.cons': '[High Risk] Severe performance degradation. "external merge", "Disk Usage". Increase work_mem.',

    'vis.kb.userFunc.title': 'User Function',
    'vis.kb.userFunc.desc': 'Custom function execution. (Rule: Gauss-XN-011)',
    'vis.kb.userFunc.pros': 'Business logic.',
    'vis.kb.userFunc.cons': '[High Risk] If inside Join Filter with high rows, efficiency drops drastically.',

    'vis.kb.rownum.title': 'Rownum',
    'vis.kb.rownum.desc': 'Pagination/Limiting. (Rule: Gauss-XN-013)',
    'vis.kb.rownum.pros': 'Paging.',
    'vis.kb.rownum.cons': '[High Risk] If rows > 10000, index might not be pushed down.',

    // Analysis Rules (Dynamic Issues)
    'vis.rule.001.title': 'High Total Cost',
    'vis.rule.001.desc': 'Total cost is {cost}, exceeding threshold 1000.',
    'vis.rule.001.sugg': 'Analyze execution plan to reduce cost.',
    
    'vis.rule.002.title': 'Large Seq Scan',
    'vis.rule.002.desc': 'Seq Scan on large table (>10k rows).',
    'vis.rule.002.sugg': 'Check if indexes exist or can be used effectively.',

    'vis.rule.003.title': 'SubPlan Detected',
    'vis.rule.003.desc': 'Plan contains SubPlan/SubQuery operators.',
    'vis.rule.003.sugg': 'Consider rewriting using JOIN or CTE for better optimization.',

    'vis.rule.004.title': 'Cartesian Product',
    'vis.rule.004.desc': 'Nested Loop without Index Condition.',
    'vis.rule.004.sugg': 'CRITICAL: Check join conditions immediately to avoid M*N complexity.',

    'vis.rule.005.title': 'No Partition Pruning',
    'vis.rule.005.desc': 'Partition Iterator implies scanning multiple/all partitions.',
    'vis.rule.005.sugg': 'Check if filter conditions include partition key.',

    'vis.rule.006.title': 'Slow SQL (>3s)',
    'vis.rule.006.desc': 'Execution time is {time}ms.',
    'vis.rule.006.sugg': 'Analyze bottlenecks (I/O, locks, CPU).',

    'vis.rule.007.title': 'Bitmap Scan',
    'vis.rule.007.desc': 'Bitmap Heap/Index Scan usage.',
    'vis.rule.007.sugg': 'Consider composite index if Recheck step filters many rows.',

    'vis.rule.008.title': 'Disk Spill / Memory',
    'vis.rule.008.desc': 'Operation spilled to Disk (Temp File).',
    'vis.rule.008.sugg': 'Increase work_mem or optimize query to reduce intermediate dataset size.',

    'vis.rule.009.title': 'Index Scan with Filter',
    'vis.rule.009.desc': 'Index Scan followed by Filter operator.',
    'vis.rule.009.sugg': 'Index not covering all predicates. Check for implicit conversions.',

    'vis.rule.011.title': 'User Function in Filter',
    'vis.rule.011.desc': 'Custom function call detected in filter.',
    'vis.rule.011.sugg': 'Ensure function efficiency or avoid executing on large row sets.',

    'vis.rule.012.title': 'Update Set Subquery',
    'vis.rule.012.desc': 'Multiple SubPlans detected in Update.',
    'vis.rule.012.sugg': 'Rewrite as Update ... From or Merge to avoid multiple executions per row.',

    'vis.rule.013.title': 'Inefficient Rownum',
    'vis.rule.013.desc': 'Rownum filter on large result set (>10k rows).',
    'vis.rule.013.sugg': 'Check if index pushdown is possible.',
  },
  zh: {
    // Menu
    'menu.dashboard': '仪表盘',
    'menu.reports': 'WDR 报告',
    'menu.comparison': '对比分析',
    'menu.visualizer': '执行计划分析',
    'menu.plandiff': '执行计划对比',
    'menu.thresholds': '阈值配置',
    'menu.sqlaudit': 'SQL 审计',
    'menu.auditlog': '审计日志',

    // Header
    'header.role': 'DBA 管理员',

    // Dashboard
    'dash.cpu': 'CPU 使用率',
    'dash.mem': '内存使用率',
    'dash.tps': 'TPS',
    'dash.qps': 'QPS',
    'dash.health': '实例健康度',
    'dash.trend': 'Top 问题趋势 (今日)',
    'dash.hotIssues': 'Top 10 热门问题',
    'dash.recentReports': '近期 WDR 报告',
    'dash.view': '查看',
    'dash.details': '详情',
    'dash.healthy': '健康',
    'dash.warning': '警告',
    'dash.critical': '严重',
    'dash.instanceOverview': '实例概览',
    'dash.selectInstance': '选择实例',
    'dash.allInstances': '所有实例',
    'dash.lastReport': '最新报告',
    'dash.activeIssues': '活跃问题',
    'dash.score': '健康分',

    // Reports
    'rep.search': '搜索实例...',
    'rep.upload': '上传报告',
    'rep.id': 'ID',
    'rep.instance': '实例',
    'rep.generated': '生成时间',
    'rep.period': '时段',
    'rep.status': '状态',
    'rep.actions': '操作',
    'rep.loading': '加载中...',
    'rep.uploadTitle': '上传 WDR 报告',
    'rep.instanceName': '实例名称',
    'rep.desc': '描述 (可选)',
    'rep.file': '报告文件',
    'rep.clickUpload': '点击上传或拖拽文件',
    'rep.fileHint': '支持 HTML 或 WDR 文件，最大 50MB',
    'rep.cancel': '取消',
    'rep.submit': '确认上传',
    'rep.showing': '显示 {start}-{end} 共 {total}',
    'rep.prev': '上一页',
    'rep.next': '下一页',
    'rep.deleteTitle': '删除报告',
    'rep.deleteConfirm': '确定要删除报告 #{id} 吗？此操作无法撤销。',
    'rep.delete': '删除',
    'rep.viewTitle': '报告详情',
    'rep.tab.summary': '摘要',
    'rep.tab.load': '负载概况',
    'rep.tab.sqlstats': 'SQL 统计',
    'rep.tab.objstats': '对象统计',
    'rep.summary.efficiency': '实例效率指标',
    'rep.summary.workload': '负载概况 (每秒)',
    'rep.summary.db': '数据库统计',
    'rep.metric': '指标',
    'rep.perSec': '每秒',
    'rep.perTxn': '每事务',
    'rep.sql.orderBy': '排序方式',
    'rep.sql.elapsed': '执行耗时',
    'rep.sql.cpu': 'CPU 时间',
    'rep.sql.calls': '执行次数',
    'rep.sql.reads': '物理读',
    'rep.sql.text': '完整 SQL',
    'rep.sql.visualize': '可视化计划',
    'rep.obj.table': '表统计',
    'rep.obj.index': '索引统计',
    'rep.obj.deadTup': '死元组',
    'rep.obj.liveTup': '活元组',
    'rep.obj.seqScan': '全表扫描',
    'rep.obj.idxScan': '索引扫描',

    // Comparison
    'comp.selected': '已选报告',
    'comp.new': '新建对比',
    'comp.name': '对比名称',
    'comp.desc': '描述',
    'comp.save': '保存',
    'comp.tab.sql': 'SQL 统计',
    'comp.tab.wait': '等待事件',
    'comp.tab.obj': '对象统计',
    'comp.tab.sys': '系统指标',
    'comp.fingerprint': 'SQL 指纹',
    'comp.r1': '报告 1',
    'comp.r2': '报告 2',
    'comp.change': '变化率',
    'comp.plan': '计划',
    'comp.action': '操作',
    'comp.col.event': '事件名称',
    'comp.col.class': '类别',
    'comp.col.time': '耗时 (ms)',
    'comp.col.object': '对象名称',
    'comp.col.schema': '模式',
    'comp.col.scans': '扫描次数',
    'comp.col.metric': '指标名称',
    'comp.col.val': '数值',
    'comp.col.diff': '差值',
    'comp.col.cpu': 'CPU时间',
    'comp.col.io': 'IO时间',
    'comp.col.seq': '全表扫描',
    'comp.col.idx': '索引扫描',
    'comp.col.tup': '元组(I/U/D)',
    'comp.overview.title': '指标对比概览',
    'comp.chart.dbTime': 'DB Time (秒)',
    'comp.chart.cpu': 'CPU 使用率 (%)',
    'comp.chart.io': 'IOPS',
    'comp.col.phyRd': '物理读',
    'comp.col.logRd': '逻辑读',
    'comp.col.heapRd': '堆读取',
    'comp.col.heapHit': '堆命中',
    'comp.col.idxRd': '索引读取',
    'comp.col.idxHit': '索引命中',

    // Comparison Summary
    'comp.summary.title': '分析摘要',
    'comp.summary.conclusion': '分析结论',
    'comp.summary.findings': '关键发现',
    'comp.summary.score': '性能评分',
    'comp.status.improved': '优化',
    'comp.status.degraded': '退化',
    'comp.status.stable': '稳定',

    // Thresholds
    'thr.categories': '分类',
    'thr.config': '配置',
    'thr.batchSave': '批量保存',
    'thr.templates': '模板',
    'thr.sysTemplates': '系统模板',
    'thr.customTemplates': '自定义模板',
    'thr.key': '键名',
    'thr.value': '阈值',
    'thr.unit': '单位',
    'thr.range': '推荐范围',
    'thr.action': '操作',

    // SQL Audit
    'audit.all': '全部',
    'audit.pending': '待处理',
    'audit.processing': '处理中',
    'audit.fixed': '已修复',
    'audit.whitelisted': '白名单',
    'audit.id': 'ID',
    'audit.severity': '严重级别',
    'audit.type': '类型',
    'audit.target': '目标',
    'audit.foundTime': '发现时间',
    'audit.status': '状态',
    'audit.actions': '操作',
    'audit.optimize': '优化',
    'audit.modalTitle': 'SQL 优化诊断',
    'audit.issueId': '问题 ID',
    'audit.targetSql': '目标 SQL',
    'audit.diagnosis': '诊断分析',
    'audit.recommendation': '优化建议',
    'audit.apply': '应用修复',
    'audit.whitelist': '加入白名单',
    'audit.cancel': '取消',

    // Audit Log
    'log.allOps': '所有操作',
    'log.updateThr': '更新阈值',
    'log.export': '导出',
    'log.time': '时间',
    'log.user': '用户',
    'log.op': '操作类型',
    'log.target': '对象',
    'log.result': '结果',

    // Visualizer
    'vis.title': '执行计划可视化',
    'vis.import': '导入',
    'vis.view': '视图',
    'vis.costThreshold': '成本阈值',
    'vis.explain': '执行分析',
    'vis.help': '帮助',
    'vis.sqlEditor': 'SQL 编辑器',
    'vis.syntax': 'GaussDB 语法',
    'vis.pastePlaceholder': '在此粘贴您的 SQL...',
    'vis.planText': '计划文本',
    'vis.rawExplain': '原始 Explain',
    'vis.noPlan': '未生成计划',
    'vis.visualTree': '可视化树',
    'vis.totalCost': '总成本',
    'vis.analyzing': '正在分析执行计划...',
    'vis.selectSql': '选择 SQL 以查看计划',
    'vis.node.cost': '成本',
    'vis.node.rows': '行数',
    'vis.node.width': '宽度',
    'vis.node.target': '目标对象',
    'vis.node.details': '详情',
    'vis.opt.suggestions': '优化建议',
    'vis.opt.highCost': '检测到高成本连接',
    'vis.opt.highCostDesc': '根节点的哈希连接成本为 {cost}，超过了阈值。请检查连接列是否已建立索引。',
    'vis.opt.indexOpp': '索引建议',
    'vis.opt.indexOppDesc': '对 \'users\' 表进行顺序扫描。建议创建索引。',
    'vis.opt.loadToSee': '加载计划以查看建议',
    'vis.hot.title': 'WDR Top SQL',
    'vis.hot.viewFull': 'View Full Report',
    'vis.hot.preview': 'SQL Preview',
    'vis.hot.time': 'Time',
    'vis.hot.cost': 'Cost',
    'vis.hot.action': 'Action',
    'vis.hot.load': 'Load',

    // Diff
    'diff.title': '执行计划对比',
    'diff.compare': '对比',
    'diff.loadSample': '加载样例',
    'diff.baseline': '基准计划',
    'diff.target': '目标计划',
    'diff.mode.unified': '统一输入 (智能拆分)',
    'diff.mode.split': '分栏输入 (左右对比)',
    'diff.tip.unified': "提示: 在此粘贴两个计划。我们会根据 'Plan 2', 'Optimized Plan' 或重复的表头自动拆分。",
    'diff.placeholder.unified': '在此处粘贴基准计划和优化后的计划...',
    'diff.placeholder.left': '粘贴原始执行计划...',
    'diff.placeholder.right': '粘贴优化后的执行计划...',
    'diff.col.operation': '算子操作',
    'diff.col.costTime': '成本/时间',
    'diff.col.rows': '行数',
    'diff.col.costPct': '成本占比',
    'diff.analysis.title': '风险分析',
    'diff.analysis.newRisk': '新增风险: {risk}',
    'diff.analysis.resolved': '已解决: {risk}',
    'diff.metric.time': '时间',
    'diff.metric.execTime': '执行时间',
    'diff.risk.diskSpill': '检测到落盘 (高风险)',
    'diff.risk.largeSeqScan': '大表全表扫描 ({rows}k 行)',
    'diff.risk.highCost': '成本极高 (>10k)',
    'diff.risk.nestLoop': '大数据量嵌套循环',
    'diff.risk.badEst': '统计信息严重偏差 (>10倍)',
    'diff.verdict.improved': '优化成功',
    'diff.verdict.regressed': '性能退化',
    'diff.verdict.similar': '无明显变化',
    'diff.verdict.new': '新增',
    'diff.verdict.removed': '移除',

    // Knowledge Base General
    'vis.kb.title': 'GaussDB 算子知识库',
    'vis.kb.search': '搜索算子或风险点...',
    'vis.kb.pros': '优化建议 (Action)',
    'vis.kb.cons': '发现问题 (Risk)',
    
    // KB Entries (Rules 001-013 included implicitly or explicitly)
    'vis.kb.seqScan.title': '顺序扫描 (Seq Scan)',
    'vis.kb.seqScan.desc': '全表顺序扫描。 (规则ID: Gauss-XN-002)',
    'vis.kb.seqScan.pros': '对于小表或需获取全量数据的场景可接受。',
    'vis.kb.seqScan.cons': '[中风险] 若 Rows > 10000 且 Cost > 100，可能存在缺失索引或隐式转换问题。',
    
    'vis.kb.idxScan.title': '索引扫描 (Index Scan)',
    'vis.kb.idxScan.desc': '索引范围扫描。 (规则ID: Gauss-XN-009)',
    'vis.kb.idxScan.pros': '高选择性查询的首选。',
    'vis.kb.idxScan.cons': '[高风险] 若存在 Filter 且过滤条件包含索引字段，说明存在隐式转换或表达式，导致无法走索引覆盖，回表开销大。',
    
    'vis.kb.idxOnlyScan.title': '仅索引扫描 (Index Only Scan)',
    'vis.kb.idxOnlyScan.desc': '直接从索引中获取数据。',
    'vis.kb.idxOnlyScan.pros': '性能最优，避免回表。',
    'vis.kb.idxOnlyScan.cons': '依赖可见性映射 (VM)，需定期 Vacuum。',
    
    'vis.kb.bitmapScan.title': '位图扫描 (Bitmap Scan)',
    'vis.kb.bitmapScan.desc': '位图索引扫描。 (规则ID: Gauss-XN-007)',
    'vis.kb.bitmapScan.pros': '创建联合索引覆盖查询条件。',
    'vis.kb.bitmapScan.cons': '[中风险] 若 Recheck Cond 行数多但 Filter 过滤掉大部分数据，说明索引效率低。',

    'vis.kb.nestLoop.title': '嵌套循环 (Nested Loop)',
    'vis.kb.nestLoop.desc': '双层循环连接。 (规则ID: Gauss-XN-004)',
    'vis.kb.nestLoop.pros': '小数据集关联效率高。',
    'vis.kb.nestLoop.cons': '[高风险] 若没有 Index Cond，极可能发生了笛卡尔积！请立即检查关联条件。',
    
    'vis.kb.hashJoin.title': '哈希连接 (Hash Join)',
    'vis.kb.hashJoin.desc': '内存哈希表连接。',
    'vis.kb.hashJoin.pros': '大数据关联标准方式。',
    'vis.kb.hashJoin.cons': '内存敏感，若出现 Disk Spill 则性能急剧下降。',
    
    'vis.kb.mergeJoin.title': '归并连接 (Merge Join)',
    'vis.kb.mergeJoin.desc': '排序后合并。',
    'vis.kb.mergeJoin.pros': '输入已排序时效率极高。',
    'vis.kb.mergeJoin.cons': '若需 Sort 操作则成本昂贵。',
    
    'vis.kb.agg.title': '聚合操作 (Aggregate)',
    'vis.kb.agg.desc': '分组或求和。 (规则ID: Gauss-XN-010)',
    'vis.kb.agg.pros': '手动优化 SQL 或调整参数。',
    'vis.kb.agg.cons': '[高风险] GaussDB 下子查询 Group By 索引可能无法内推（对比 Oracle），导致全表扫描。',
    
    'vis.kb.sort.title': '排序 (Sort)',
    'vis.kb.sort.desc': '数据排序。',
    'vis.kb.sort.pros': 'Order By 必须。',
    'vis.kb.sort.cons': '关注是否有 "external merge" 落盘现象。',

    'vis.kb.cteScan.title': 'CTE 扫描',
    'vis.kb.cteScan.desc': '通用表达式扫描。',
    'vis.kb.cteScan.pros': '提升代码可读性。',
    'vis.kb.cteScan.cons': '可能成为优化器栅栏，阻碍谓词下推。',

    'vis.kb.materialize.title': '物化 (Materialize)',
    'vis.kb.materialize.desc': '中间结果存储。',
    'vis.kb.materialize.pros': '支持重复读取。',
    'vis.kb.materialize.cons': '增加内存和启动开销。',

    'vis.kb.limit.title': '限制 (Limit)',
    'vis.kb.limit.desc': '返回部分行。',
    'vis.kb.limit.pros': '分页查询。',
    'vis.kb.limit.cons': '若下层有 Sort，则必须完成排序才能 Limit。',

    'vis.kb.subqueryScan.title': '子查询/SubPlan',
    'vis.kb.subqueryScan.desc': '子查询执行。 (规则ID: Gauss-XN-003, 012)',
    'vis.kb.subqueryScan.pros': '逻辑隔离。建议改写为 CTE 或 Join。',
    'vis.kb.subqueryScan.cons': '[高风险] 1. Update Set 使用子查询会导致多字段多次执行。 2. 结合 SeqScan/NestLoop 易导致性能问题。',

    'vis.kb.append.title': '追加 (Append)',
    'vis.kb.append.desc': '集合合并 (UNION ALL)。',
    'vis.kb.append.pros': '分区处理。',
    'vis.kb.append.cons': '串行处理效率受限。',

    'vis.kb.result.title': '结果 (Result)',
    'vis.kb.result.desc': '返回常量或计算值。',
    'vis.kb.result.pros': '极快。',
    'vis.kb.result.cons': '无。',

    'vis.kb.partIter.title': '分区迭代器',
    'vis.kb.partIter.desc': '分区表扫描。 (规则ID: Gauss-XN-005)',
    'vis.kb.partIter.pros': '分区剪枝 (Pruning)。',
    'vis.kb.partIter.cons': '[高风险] 若 Iterations 很大，说明没有触发分区剪枝，扫描了所有分区。',

    // 新增特定规则
    'vis.kb.diskSpill.title': '落盘 (Disk Spill)',
    'vis.kb.diskSpill.desc': '内存不足写磁盘。 (规则ID: Gauss-XN-008)',
    'vis.kb.diskSpill.pros': '增加 work_mem，优化 SQL 减少中间集。',
    'vis.kb.diskSpill.cons': '[高风险] 严重性能问题。特征：Batches>1, Disk Usage, external merge。',

    'vis.kb.userFunc.title': '自定义函数',
    'vis.kb.userFunc.desc': '用户函数执行。 (规则ID: Gauss-XN-011)',
    'vis.kb.userFunc.pros': '建议在函数前加 Select 或改写减少调用。',
    'vis.kb.userFunc.cons': '[高风险] 在 Join Filter 中且驱动表行数大（>10万）时，效率极低。',

    'vis.kb.rownum.title': 'Rownum 过滤',
    'vis.kb.rownum.desc': '行号过滤。 (规则ID: Gauss-XN-013)',
    'vis.kb.rownum.pros': '代码调优。',
    'vis.kb.rownum.cons': '[高风险] 若 Rows > 10000，索引可能未内推，性能劣化。',

    // Analysis Rules (Dynamic Issues)
    'vis.rule.001.title': '总体代价 (Cost) 高',
    'vis.rule.001.desc': '总体代价为 {cost}，超过阈值 1000。',
    'vis.rule.001.sugg': '分析执行计划并压降 Cost。',
    
    'vis.rule.002.title': '全表扫描 (Seq Scan)',
    'vis.rule.002.desc': '对大表 (>10k 行) 进行了全表扫描。',
    'vis.rule.002.sugg': '检查是否存在可用索引，或是否发生隐式转换。',

    'vis.rule.003.title': '检测到 SubPlan',
    'vis.rule.003.desc': '计划中包含 SubPlan/SubQuery 算子。',
    'vis.rule.003.sugg': '建议尝试使用 JOIN 或 CTE 重写查询。',

    'vis.rule.004.title': '笛卡尔积风险',
    'vis.rule.004.desc': 'Nested Loop 没有关联的 Index Cond。',
    'vis.rule.004.sugg': '严重：请立即检查 Join 条件是否缺失。',

    'vis.rule.005.title': '分区未剪枝',
    'vis.rule.005.desc': '分区迭代器 (Partition Iterator) 扫描了多个/所有分区。',
    'vis.rule.005.sugg': '检查过滤条件是否包含分区键。',

    'vis.rule.006.title': '慢 SQL (>3s)',
    'vis.rule.006.desc': '执行时间为 {time}ms。',
    'vis.rule.006.sugg': '分析瓶颈（I/O, 锁, CPU）。',

    'vis.rule.007.title': '位图扫描',
    'vis.rule.007.desc': '使用了 Bitmap Heap/Index Scan。',
    'vis.rule.007.sugg': '如果 Recheck 过滤了大量行，建议考虑复合索引。',

    'vis.rule.008.title': '落盘 / 内存不足',
    'vis.rule.008.desc': '操作溢出到磁盘 (Temp File/Disk Spill)。',
    'vis.rule.008.sugg': '增加 work_mem 或优化 SQL 以减少中间数据集大小。',

    'vis.rule.009.title': '索引扫描带过滤',
    'vis.rule.009.desc': '索引扫描后紧跟 Filter 操作。',
    'vis.rule.009.sugg': '索引未覆盖所有谓词。检查是否存在隐式类型转换。',

    'vis.rule.011.title': 'Filter 中包含自定义函数',
    'vis.rule.011.desc': '检测到 Filter 中调用了用户函数。',
    'vis.rule.011.sugg': '确保函数高效，或避免在大结果集上调用。',

    'vis.rule.012.title': 'Update Set 子查询',
    'vis.rule.012.desc': 'Update 语句中检测到多个 SubPlan。',
    'vis.rule.012.sugg': '建议改写为 Update ... From 或 Merge 语法，避免每行多次执行。',

    'vis.rule.013.title': 'Rownum 效率低',
    'vis.rule.013.desc': 'Rownum 过滤大量行 (>10k)。',
    'vis.rule.013.sugg': '检查索引是否能下推。',
  }
};

interface I18nContextProps {
  language: Language;
  setLanguage: (lang: Language) => void;
  t: (key: string, params?: Record<string, any>) => string;
}

const I18nContext = createContext<I18nContextProps | undefined>(undefined);

export const I18nProvider: React.FC<{ children: ReactNode }> = ({ children }) => {
  const [language, setLanguage] = useState<Language>(() => {
    return (localStorage.getItem('app_language') as Language) || 'zh';
  });

  useEffect(() => {
    localStorage.setItem('app_language', language);
  }, [language]);

  const t = (key: string, params?: Record<string, any>) => {
    let text = translations[language][key as keyof typeof translations['en']] || key;
    if (params) {
        Object.entries(params).forEach(([k, v]) => {
            text = text.replace(`{${k}}`, String(v));
        });
    }
    return text;
  };

  return (
    <I18nContext.Provider value={{ language, setLanguage, t }}>
      {children}
    </I18nContext.Provider>
  );
};

export const useI18n = () => {
  const context = useContext(I18nContext);
  if (!context) {
    throw new Error('useI18n must be used within an I18nProvider');
  }
  return context;
};
