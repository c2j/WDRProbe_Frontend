
# WDRProbe 需求规格说明书 (SRS)

## 1. 引言
WDRProbe 是一款针对 GaussDB 数据库 WDR (Workload Diagnosis Report) 报告的智能分析工具。旨在帮助 DBA 和运维人员通过图形化界面快速识别性能瓶颈、分析负载趋势、对比不同时段的性能差异，并提供 SQL 优化建议。

## 2. 功能需求

### 2.1 仪表盘 (Dashboard)
*   **KPI 概览**: 需展示核心性能指标，包括 CPU 使用率、内存使用率、TPS (每秒事务数)、QPS (每秒查询数)。
*   **实例健康度**: 通过饼图展示所有纳管实例的健康分布（健康/警告/严重）。
*   **趋势分析**: 展示当天的 Top 问题趋势折线图。
*   **热门问题 (Hot Issues)**: 自动识别并列出当前 Top 10 的数据库性能问题（如锁等待超时、死锁、慢 SQL）。
*   **近期报告**: 列出最新的 WDR 报告生成记录，支持快速跳转查看。
*   **实例筛选**: 支持查看特定实例或全局视图。

### 2.2 WDR 报告管理 (Report Management)
*   **报告列表**: 展示报告 ID、实例名称、生成时间、采样时段、状态（成功/失败）。
*   **报告导入**: 支持上传 HTML 或 WDR 原始文件（支持拖拽上传）。
*   **报告操作**:
    *   **查看 (View)**: 跳转至报告详情页。
    *   **对比 (Compare)**: 将当前报告作为源报告发起对比分析。
    *   **删除 (Delete)**: 删除历史报告，需包含二次确认机制。

### 2.3 报告详情分析 (Report Detail)
*   **总览 (Overview)**:
    *   **效率仪表盘**: 视化展示 Buffer Hit%、CPU 效率、软解析率等关键指标。
    *   **负载概况**: 表格展示 DB Time, CPU Time, IO 请求等每秒/每事务指标。
*   **SQL 统计 (SQL Statistics)**:
    *   展示 Top SQL 列表，支持按 Elapsed Time, CPU Time, Executions 等排序。
    *   支持查看完整 SQL 文本。
    *   提供跳转至“执行计划可视化”的入口。
*   **对象统计 (Object Statistics)**:
    *   展示表和索引的扫描情况（全表扫描 vs 索引扫描）。
    *   展示元组变更统计（Insert/Update/Delete）及死元组 (Dead Tuples) 数量，高亮显示需要 Vacuum 的表。

### 2.4 对比分析 (Comparison Analysis)
*   **多维度对比**: 支持选择两份报告进行差异分析。
*   **分析摘要**: 自动生成文本形式的分析结论、关键发现及性能评分变化。
*   **可视化概览**: 通过柱状图对比 DB Time, CPU, IOPS 等核心指标的变化。
*   **详细对比**:
    *   **SQL 对比**: 对比同一 SQL 在两个时段的 CPU 时间、IO 时间、物理读、逻辑读的变化率。
    *   **等待事件对比**: 对比各类等待事件的耗时差异。
    *   **对象统计对比**: 对比表/索引扫描次数及元组变化。
    *   **系统指标对比**: 对比全局 Buffer 命中率、吞吐量等。

### 2.5 执行计划可视化 (Plan Visualizer)
*   **计划输入**: 支持从 Top SQL 列表导入或手动粘贴 SQL/Plan。
*   **可视化树**: 将执行计划渲染为树状结构，节点展示算子类型、Cost、Rows。
*   **智能诊断**:
    *   自动高亮高成本节点（如 Cost > 阈值）。
    *   自动识别优化机会（如缺失索引导致的 Seq Scan）。
    *   提供算子（如 Hash Join, Nested Loop）的教学指南。
*   **多视图切换**: 支持 SQL 编辑器、原始文本计划、可视化树形图的布局切换。

### 2.6 阈值配置 (Threshold Configuration)
*   **分类管理**: 支持 SQL、Wait、System、AI 等维度的阈值配置。
*   **参数编辑**: 支持修改阈值数值，提供推荐范围提示。
*   **模板管理**: 支持应用系统预置模板（如“高并发模板”）或保存自定义模板。

### 2.7 SQL 审计 (SQL Audit)
*   **问题列表**: 展示自动审计发现的 SQL 问题（如全表扫描、低效索引）。
*   **优化建议**: 提供诊断原因及具体的优化建议（如 Create Index 语句）。
*   **状态管理**: 支持将问题标记为“白名单”或“已修复”。

### 2.8 审计日志 (Audit Log)
*   **操作记录**: 记录用户对系统的操作（如更新阈值、删除报告）。
*   **日志导出**: 支持导出审计日志。

## 3. 非功能需求
*   **国际化**: 支持中英文一键切换。
*   **响应式设计**: 适配不同分辨率的屏幕。
*   **交互体验**: 关键操作（如删除、大文件加载）需有 Loading 状态和反馈提示。
